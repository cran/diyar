<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2020-06-13" />

<title>Multistage deterministic linkage in R</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Multistage deterministic linkage in R</h1>
<h4 class="date">13 June 2020</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Linking multiple datasets to consolidate information is a common task in research, particularly for those involving the use of “big data”. Deterministic record linkage is the simplest and most common method of record linkage however, its accuracy relies on data quality. Too many incorrect or missing values will often provide an unacceptable number of false matches or mismatches.</p>
<p>This function aims to provide a simple, multistage and flexible implementation of deterministic record linkage which tries to improve the linkage of datasets with missing or incorrect group identifiers e.g. customer, patient or admission codes. In such instances, alternative identifiers like dates, names, height or other attributes are used in a specified order of preference.</p>
</div>
<div id="uses" class="section level1">
<h1>Uses</h1>
<p>Each argument in <code>record_group()</code> controls separate aspects of the linkage process. Different combinations of options can be used to link datasets in a variety of ways. Examples of these include;</p>
<ul>
<li>Linking datasets on one (or more) matching <code>criteria</code></li>
<li>Linking datasets on one (or more) matching <code>criteria</code> and one (or more) matching <code>sub_criteria</code>. See <a href="#record_matching">record matching</a></li>
<li>Linking datasets in stages. Each stage is considered more relevant than the subsequent one. See <a href="#record_expansion">record group expansion</a></li>
<li>Linking datasets with missing group identifiers. See <a href="#missing_values">handling missing values</a></li>
</ul>
</div>
<div id="implementation" class="section level1">
<h1>Implementation</h1>
<p>Record linkage is done in stages. A match at each stage is considered more relevant than matches at subsequent stages. Matching records are assigned a unique group ID. The group ID is essentially the record ID (<code>sn</code>) of one of the matching records. Therefore, a familiar record ID (<code>sn</code>) can prove useful.</p>
<p>There are matching <code>criteria</code> (column) for each stage. These are passed to the function as column names. The argument supports quasiquotation.</p>
<p><code>sub_criteria</code> are additional matching conditions (columns) that can be paired with each <code>criteria</code>. This is provided as a <code>list</code> of named <code>vectors</code>. Each named <code>vector</code> contains a set of column names. When a <code>sub_criteria</code> is used, records will only be assigned to the same group ID if they match on the <code>criteria</code>, and at least one named column in each <code>sub_criteria</code>.</p>
<p>Each <code>sub_criteria</code> should be paired with a corresponding <code>criteria</code>. To do this, the vector name for each <code>sub_criteria</code> should be - <code>&quot;s&quot;</code> followed by the corresponding <code>criteria</code> number e.g. <code>&quot;s1&quot;</code> or <code>&quot;s4&quot;</code>. When a <code>criteria</code> is paired to more than one <code>sub_criteria</code>, include a suffix after the <code>criteria</code> number e.g. <code>&quot;s1a&quot;</code>, <code>&quot;s1b&quot;</code> and <code>&quot;s1c&quot;</code> (<a href="#sub_cri_example">See examples</a>). Any <code>sub_criteria</code> not paired with a <code>criteria</code> will be ignored. The <code>sub_criteria</code> argument does not support quasiquotation.</p>
<p>At each stage, the function prints the number of records that were assigned a group ID and how many groups have only one record.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(diyar);
<span class="kw">data</span>(patient_list); 
dbs &lt;-<span class="st"> </span>patient_list[<span class="kw">c</span>(<span class="st">&quot;forename&quot;</span>,<span class="st">&quot;surname&quot;</span>,<span class="st">&quot;sex&quot;</span>)]; dbs
<span class="co">#&gt;   forename surname sex</span>
<span class="co">#&gt; 1    James   Green   M</span>
<span class="co">#&gt; 2   ESTHER  Kulmar   F</span>
<span class="co">#&gt; 3              OBI   F</span>
<span class="co">#&gt; 4    Jamey   Green   M</span>
<span class="co">#&gt; 5   Daniel  Kulmar   M</span>
<span class="co">#&gt; 6    Henry     OBI   M</span>

<span class="co"># 1 stage &lt;- Matching surname only</span>
dbs<span class="op">$</span>pids_a &lt;-<span class="kw">record_group</span>(dbs, <span class="dt">criteria =</span> surname, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `surname`</span>
<span class="co">#&gt; 6 records(s): 6 assigned to record groups and 0 left to group.</span>
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

<span class="co"># 2 stage - Matching surname, then matching sex</span>
dbs<span class="op">$</span>pids_b &lt;-<span class="st"> </span><span class="kw">record_group</span>(dbs, <span class="dt">criteria =</span> <span class="kw">c</span>(surname, sex), <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

dbs
<span class="co">#&gt;   forename surname sex       pids_a       pids_b</span>
<span class="co">#&gt; 1    James   Green   M P.1 (CRI 01) P.1 (CRI 01)</span>
<span class="co">#&gt; 2   ESTHER  Kulmar   F P.2 (CRI 01) P.2 (CRI 01)</span>
<span class="co">#&gt; 3              OBI   F P.3 (CRI 01) P.3 (CRI 01)</span>
<span class="co">#&gt; 4    Jamey   Green   M P.1 (CRI 01) P.1 (CRI 01)</span>
<span class="co">#&gt; 5   Daniel  Kulmar   M P.2 (CRI 01) P.2 (CRI 01)</span>
<span class="co">#&gt; 6    Henry     OBI   M P.3 (CRI 01) P.3 (CRI 01)</span>

<span class="co"># Note that exact matching is case sensitive. See range matching.</span></code></pre></div>
<p><a id="record_matching"></a></p>
<div id="record-matching" class="section level2">
<h2>Record matching</h2>
<p>The choice and ordering of column names in <code>criteria</code> and <code>sub_criteria</code> determines the relevance of matches. This flexibility allows you to link records in different ways. However, you should always consider the most practical combination to get more true matches than false one.</p>
<p>For example, in <code>patient_list</code> above, linking on surnames and then sex (<code>pid_b</code>) leads to a different result compared to when linking on sex before surnames (<code>pid_c</code>) (See <a href="#record_expansion">Record group expansion</a>). In <code>pid_b</code>, a match on the individual’s surname was considered more relevant than a match on their sex. The opposite was the case for <code>pid_c</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs<span class="op">$</span>pids_c &lt;-<span class="st"> </span><span class="kw">record_group</span>(dbs, <span class="dt">criteria =</span>  <span class="kw">c</span>(sex, surname), <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

dbs
<span class="co">#&gt;   forename surname sex       pids_a       pids_b       pids_c</span>
<span class="co">#&gt; 1    James   Green   M P.1 (CRI 01) P.1 (CRI 01) P.1 (CRI 01)</span>
<span class="co">#&gt; 2   ESTHER  Kulmar   F P.2 (CRI 01) P.2 (CRI 01) P.2 (CRI 01)</span>
<span class="co">#&gt; 3              OBI   F P.3 (CRI 01) P.3 (CRI 01) P.2 (CRI 01)</span>
<span class="co">#&gt; 4    Jamey   Green   M P.1 (CRI 01) P.1 (CRI 01) P.1 (CRI 01)</span>
<span class="co">#&gt; 5   Daniel  Kulmar   M P.2 (CRI 01) P.2 (CRI 01) P.1 (CRI 01)</span>
<span class="co">#&gt; 6    Henry     OBI   M P.3 (CRI 01) P.3 (CRI 01) P.1 (CRI 01)</span></code></pre></div>
<p>Considering the <code>criteria</code> used for each, both results are logically correct but <code>pids_b</code> is not the most practical option given the dataset. For instance, records 3 and 6 which have been grouped together could actually be cousins not the same individual. A better combination would be forename at stage 1, followed by surname and sex at stage 2. See <code>pid_d</code> below;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbs_<span class="dv">2</span> &lt;-<span class="st"> </span>patient_list; dbs_<span class="dv">2</span>
<span class="co">#&gt;   rd_id forename surname sex</span>
<span class="co">#&gt; 1     1    James   Green   M</span>
<span class="co">#&gt; 2     2   ESTHER  Kulmar   F</span>
<span class="co">#&gt; 3     3              OBI   F</span>
<span class="co">#&gt; 4     4    Jamey   Green   M</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M</span>
<span class="co">#&gt; 6     6    Henry     OBI   M</span>

dbs_<span class="dv">2</span><span class="op">$</span>cri_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">paste</span>(dbs_<span class="dv">2</span><span class="op">$</span>surname, dbs_<span class="dv">2</span><span class="op">$</span>sex,<span class="dt">sep=</span><span class="st">&quot;-&quot;</span>)
dbs_<span class="dv">2</span><span class="op">$</span>pid_d &lt;-<span class="st"> </span><span class="kw">record_group</span>(dbs_<span class="dv">2</span>, rd_id, <span class="kw">c</span>(forename, cri_<span class="dv">2</span>), <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 4 record(s) with a unique ID.</span>

dbs_<span class="dv">2</span>
<span class="co">#&gt;   rd_id forename surname sex    cri_2        pid_d</span>
<span class="co">#&gt; 1     1    James   Green   M  Green-M P.1 (CRI 02)</span>
<span class="co">#&gt; 2     2   ESTHER  Kulmar   F Kulmar-F P.2 (No Hit)</span>
<span class="co">#&gt; 3     3              OBI   F    OBI-F P.3 (No Hit)</span>
<span class="co">#&gt; 4     4    Jamey   Green   M  Green-M P.1 (CRI 02)</span>
<span class="co">#&gt; 5     5   Daniel  Kulmar   M Kulmar-M P.5 (No Hit)</span>
<span class="co">#&gt; 6     6    Henry     OBI   M    OBI-M P.6 (No Hit)</span></code></pre></div>
<p>As mentioned earlier, at each stage of record linkage, a <code>sub_criteria</code> can be used to supply additional matching conditions. Just like <code>criteria</code>, any column in the dataset can be used as a <code>sub_criteria</code>.</p>
<p><a id="sub_cri_example"></a></p>
<p>Below are examples of record linkage using different combinations of the same <code>criteria</code> and <code>sub_criteria</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Opes); Opes
<span class="co">#&gt;   rd_id name  department hair_colour date_of_birth db_pt1  db_pt2  db_pt3</span>
<span class="co">#&gt; 1     1  Ope Procurement       Brown    23/03/1986  23/03 23/1986 03/1986</span>
<span class="co">#&gt; 2     2  Ope    Security       Brown    23/03/1986  23/03 23/1986 03/1986</span>
<span class="co">#&gt; 3     3  Ope    Security       Brown    23/03/1968  23/03 23/1968 03/1968</span>
<span class="co">#&gt; 4     4  Ope  Publishing       Green    01/02/1985  01/02 01/1985 02/1985</span>
<span class="co">#&gt; 5     5  Ope  Publishing        Teal    02/01/1985  02/01 02/1985 01/1985</span>
<span class="co">#&gt; 6     6  Ope  Publishing        Grey    11/03/1964  11/03 11/1964 03/1964</span>
<span class="co">#&gt; 7     7  Ope  Publishing       White    11/03/1964  11/03 11/1964 03/1964</span>
<span class="co">#&gt; 8     8  Ope Procurement       Black    11/10/1985  11/10 11/1985 10/1985</span>

<span class="co"># 1 stage linkage</span>
  <span class="co"># stage 1 - name AND (department OR hair_colour OR date_of_birth)</span>
Opes<span class="op">$</span>pids_a &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes, <span class="dt">criteria =</span> name, 
                            <span class="dt">sub_criteria =</span> <span class="kw">list</span>(
                              <span class="st">&quot;s1a&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>,<span class="st">&quot;date_of_birth&quot;</span>)),
                            <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

Opes[<span class="kw">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>,<span class="st">&quot;date_of_birth&quot;</span>,<span class="st">&quot;pids_a&quot;</span>)]
<span class="co">#&gt;   name  department hair_colour date_of_birth       pids_a</span>
<span class="co">#&gt; 1  Ope Procurement       Brown    23/03/1986 P.1 (CRI 01)</span>
<span class="co">#&gt; 2  Ope    Security       Brown    23/03/1986 P.1 (CRI 01)</span>
<span class="co">#&gt; 3  Ope    Security       Brown    23/03/1968 P.1 (CRI 01)</span>
<span class="co">#&gt; 4  Ope  Publishing       Green    01/02/1985 P.4 (CRI 01)</span>
<span class="co">#&gt; 5  Ope  Publishing        Teal    02/01/1985 P.4 (CRI 01)</span>
<span class="co">#&gt; 6  Ope  Publishing        Grey    11/03/1964 P.4 (CRI 01)</span>
<span class="co">#&gt; 7  Ope  Publishing       White    11/03/1964 P.4 (CRI 01)</span>
<span class="co">#&gt; 8  Ope Procurement       Black    11/10/1985 P.1 (CRI 01)</span>
  
<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name AND ((department OR hair_colour) AND (date_of_birth)) </span>
Opes<span class="op">$</span>pids_b &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes, <span class="dt">criteria =</span> name, 
                            <span class="dt">sub_criteria =</span> <span class="kw">list</span>(
                              <span class="st">&quot;s1a&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>),
                              <span class="st">&quot;s1b&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;date_of_birth&quot;</span>)),
                            <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 4 record(s) with a unique ID.</span>

Opes[<span class="kw">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>,<span class="st">&quot;date_of_birth&quot;</span>,<span class="st">&quot;pids_b&quot;</span>)]
<span class="co">#&gt;   name  department hair_colour date_of_birth       pids_b</span>
<span class="co">#&gt; 1  Ope Procurement       Brown    23/03/1986 P.1 (CRI 01)</span>
<span class="co">#&gt; 2  Ope    Security       Brown    23/03/1986 P.1 (CRI 01)</span>
<span class="co">#&gt; 3  Ope    Security       Brown    23/03/1968 P.3 (No Hit)</span>
<span class="co">#&gt; 4  Ope  Publishing       Green    01/02/1985 P.4 (No Hit)</span>
<span class="co">#&gt; 5  Ope  Publishing        Teal    02/01/1985 P.5 (No Hit)</span>
<span class="co">#&gt; 6  Ope  Publishing        Grey    11/03/1964 P.6 (CRI 01)</span>
<span class="co">#&gt; 7  Ope  Publishing       White    11/03/1964 P.6 (CRI 01)</span>
<span class="co">#&gt; 8  Ope Procurement       Black    11/10/1985 P.8 (No Hit)</span>

<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name AND ((department OR hair_colour) AND (dd-mm OR dd-yyyy OR mm-yyyy))</span>
Opes<span class="op">$</span>pids_c &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes, <span class="dt">criteria =</span> name, 
                            <span class="dt">sub_criteria =</span> <span class="kw">list</span>(
                              <span class="st">&quot;s1a&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>),
                              <span class="st">&quot;s1b&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;db_pt1&quot;</span>,<span class="st">&quot;db_pt2&quot;</span>,<span class="st">&quot;db_pt3&quot;</span>)),
                            <span class="dt">display =</span> F, <span class="dt">to_s4 =</span>T)
<span class="co">#&gt; Record grouping complete: 3 record(s) with a unique ID.</span>

Opes[<span class="kw">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>,<span class="st">&quot;date_of_birth&quot;</span>,<span class="st">&quot;pids_c&quot;</span>)]
<span class="co">#&gt;   name  department hair_colour date_of_birth       pids_c</span>
<span class="co">#&gt; 1  Ope Procurement       Brown    23/03/1986 P.1 (CRI 01)</span>
<span class="co">#&gt; 2  Ope    Security       Brown    23/03/1986 P.1 (CRI 01)</span>
<span class="co">#&gt; 3  Ope    Security       Brown    23/03/1968 P.1 (CRI 01)</span>
<span class="co">#&gt; 4  Ope  Publishing       Green    01/02/1985 P.4 (No Hit)</span>
<span class="co">#&gt; 5  Ope  Publishing        Teal    02/01/1985 P.5 (No Hit)</span>
<span class="co">#&gt; 6  Ope  Publishing        Grey    11/03/1964 P.6 (CRI 01)</span>
<span class="co">#&gt; 7  Ope  Publishing       White    11/03/1964 P.6 (CRI 01)</span>
<span class="co">#&gt; 8  Ope Procurement       Black    11/10/1985 P.8 (No Hit)</span>

<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name AND ((department)  AND (hair_colour) AND (dd-mm OR dd-yyyy OR mm-yyyy))</span>
Opes<span class="op">$</span>pids_d &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes, <span class="dt">criteria =</span>name, 
               <span class="dt">sub_criteria =</span> <span class="kw">list</span>(
                 <span class="st">&quot;s1a&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;department&quot;</span>),
                 <span class="st">&quot;s1c&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;hair_colour&quot;</span>),
                 <span class="st">&quot;s1b&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;db_pt1&quot;</span>,<span class="st">&quot;db_pt2&quot;</span>,<span class="st">&quot;db_pt3&quot;</span>)),  
               <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 6 record(s) with a unique ID.</span>

Opes[<span class="kw">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>,<span class="st">&quot;date_of_birth&quot;</span>,<span class="st">&quot;pids_d&quot;</span>)]
<span class="co">#&gt;   name  department hair_colour date_of_birth       pids_d</span>
<span class="co">#&gt; 1  Ope Procurement       Brown    23/03/1986 P.1 (No Hit)</span>
<span class="co">#&gt; 2  Ope    Security       Brown    23/03/1986 P.2 (CRI 01)</span>
<span class="co">#&gt; 3  Ope    Security       Brown    23/03/1968 P.2 (CRI 01)</span>
<span class="co">#&gt; 4  Ope  Publishing       Green    01/02/1985 P.4 (No Hit)</span>
<span class="co">#&gt; 5  Ope  Publishing        Teal    02/01/1985 P.5 (No Hit)</span>
<span class="co">#&gt; 6  Ope  Publishing        Grey    11/03/1964 P.6 (No Hit)</span>
<span class="co">#&gt; 7  Ope  Publishing       White    11/03/1964 P.7 (No Hit)</span>
<span class="co">#&gt; 8  Ope Procurement       Black    11/10/1985 P.8 (No Hit)</span></code></pre></div>
<p>Note that using <code>sub_criteria</code> costs additional processing time, so it should be avoided when not needed. For example, the two implementations below (<code>pids_e</code> and <code>pids_f</code>) will lead to the same outcome but <code>pids_f</code> will take less time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name AND ((department)  AND (hair_colour) AND (date_of_birth))</span>
Opes<span class="op">$</span>pids_e &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes, <span class="dt">criteri =</span> name, 
                            <span class="dt">sub_criteria =</span> <span class="kw">list</span>(
                              <span class="st">&quot;s1a&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;department&quot;</span>), 
                              <span class="st">&quot;s1b&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;hair_colour&quot;</span>), 
                              <span class="st">&quot;s1c&quot;</span>=<span class="kw">c</span>(<span class="st">&quot;date_of_birth&quot;</span>)),
                            <span class="dt">display =</span> T, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `name`</span>
<span class="co">#&gt; Matching criteria 1: iteration 2</span>
<span class="co">#&gt; Matching criteria 1: iteration 3</span>
<span class="co">#&gt; Matching criteria 1: iteration 4</span>
<span class="co">#&gt; Matching criteria 1: iteration 5</span>
<span class="co">#&gt; Matching criteria 1: iteration 6</span>
<span class="co">#&gt; Matching criteria 1: iteration 7</span>
<span class="co">#&gt; Matching criteria 1: iteration 8</span>
<span class="co">#&gt; 8 records(s): 0 assigned to record groups and 8 left to group.</span>
<span class="co">#&gt; Record grouping complete: 8 record(s) with a unique ID.</span>

Opes<span class="op">$</span>cri &lt;-<span class="st"> </span><span class="kw">paste</span>(Opes<span class="op">$</span>name, Opes<span class="op">$</span>date_of_birth, Opes<span class="op">$</span>department, Opes<span class="op">$</span>hair_colour, <span class="dt">sep=</span><span class="st">&quot;-&quot;</span>)

<span class="co"># 1 stage linkage </span>
  <span class="co"># stage 1 - name AND department AND hair_colour AND date_of_birth</span>
Opes<span class="op">$</span>pids_f &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes, <span class="dt">criteria =</span> cri,  <span class="dt">display =</span> T, <span class="dt">to_s4 =</span>T)
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `cri`</span>
<span class="co">#&gt; 8 records(s): 0 assigned to record groups and 8 left to group.</span>
<span class="co">#&gt; Record grouping complete: 8 record(s) with a unique ID.</span>

Opes[<span class="kw">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;department&quot;</span>,<span class="st">&quot;hair_colour&quot;</span>,<span class="st">&quot;date_of_birth&quot;</span>,<span class="st">&quot;pids_e&quot;</span>,<span class="st">&quot;pids_f&quot;</span>)]
<span class="co">#&gt;   name  department hair_colour date_of_birth       pids_e       pids_f</span>
<span class="co">#&gt; 1  Ope Procurement       Brown    23/03/1986 P.1 (No Hit) P.1 (No Hit)</span>
<span class="co">#&gt; 2  Ope    Security       Brown    23/03/1986 P.2 (No Hit) P.2 (No Hit)</span>
<span class="co">#&gt; 3  Ope    Security       Brown    23/03/1968 P.3 (No Hit) P.3 (No Hit)</span>
<span class="co">#&gt; 4  Ope  Publishing       Green    01/02/1985 P.4 (No Hit) P.4 (No Hit)</span>
<span class="co">#&gt; 5  Ope  Publishing        Teal    02/01/1985 P.5 (No Hit) P.5 (No Hit)</span>
<span class="co">#&gt; 6  Ope  Publishing        Grey    11/03/1964 P.6 (No Hit) P.6 (No Hit)</span>
<span class="co">#&gt; 7  Ope  Publishing       White    11/03/1964 P.7 (No Hit) P.7 (No Hit)</span>
<span class="co">#&gt; 8  Ope Procurement       Black    11/10/1985 P.8 (No Hit) P.8 (No Hit)</span></code></pre></div>
<p><a id="record_expansion"></a></p>
</div>
<div id="record-group-expansion" class="section level2">
<h2>Record group expansion</h2>
<p>At each stage of record linkage, records are either assigned a new group ID or inherit an existing one. The following scenario explain how these happen;</p>
<ul>
<li>If a record only matches others that have not yet been assigned a group ID, it and the others will then be assigned a new group ID</li>
<li>If a record matches others which already have a group ID, the record will inherit the existing group ID. Note that if it’s matched with different records from different group IDs, it will inherit the group ID that was assigned at the earlier stage since that’s the more ‘relevant’ one</li>
<li>If a record does not match any other record, it will not be assigned a group ID at that stage. If by the last stage, it still has not matched any other record, it is assigned a unique group ID</li>
</ul>
<p>Existing group IDs can be inherited but will not be overwritten. This is because groups formed at earlier stages are considered more “certain” than those formed at subsequent stages. Therefore, it’s worth reiterating that <code>record_group()</code> expects the <code>criteria</code> to be listed in order of decreasing relevance.</p>
<p><strong>Example 1 - <code>patient_list</code></strong></p>
<p><strong>Figure 1: Record group expansion</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(patient_list_<span class="dv">2</span>); patient_list_<span class="dv">2</span>
<span class="co">#&gt;   rd_id forename     surname    sex</span>
<span class="co">#&gt; 1     1            Jefferson   Male</span>
<span class="co">#&gt; 2     2            Jefferson Female</span>
<span class="co">#&gt; 3     3     Tomi       Abdul   Male</span>
<span class="co">#&gt; 4     4     Tomi Abdulkareem Female</span>
<span class="co">#&gt; 5     5     &lt;NA&gt;        &lt;NA&gt;   Male</span>

patient_list_<span class="dv">2</span><span class="op">$</span>pids_a &lt;-<span class="st"> </span><span class="kw">record_group</span>(patient_list_<span class="dv">2</span>, rd_id, <span class="kw">c</span>(forename, surname, sex), <span class="dt">to_s4 =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

patient_list_<span class="dv">2</span>
<span class="co">#&gt;   rd_id forename     surname    sex       pids_a</span>
<span class="co">#&gt; 1     1            Jefferson   Male P.1 (CRI 02)</span>
<span class="co">#&gt; 2     2            Jefferson Female P.1 (CRI 02)</span>
<span class="co">#&gt; 3     3     Tomi       Abdul   Male P.3 (CRI 01)</span>
<span class="co">#&gt; 4     4     Tomi Abdulkareem Female P.3 (CRI 01)</span>
<span class="co">#&gt; 5     5     &lt;NA&gt;        &lt;NA&gt;   Male P.3 (CRI 03)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<ul>
<li>Stage 1 (criteria) - Only records 3 and 4 are grouped together and therefore assigned a new group ID (<code>3</code>). Records 1 and 2 are excluded from grouping at this stage because of <a href="#missing_values">missing values</a>. Record 5 is not assigned a group ID because it doesn’t match any other record.</li>
<li>Stage 2 (criteria) - Records 1 and 2 are grouped together based on matching surnames and assigned a new group ID (<code>1</code>). Records 3 and 4 do not match on surnames but remain grouped together since they’ve already matched on forenames, which is more “certain” as listed in <code>criteria</code>. Record 5 is still not assigned a group ID because it doesn’t match any other record on surnames.</li>
<li>Stage 3 (criteria) - Record 5 matches record 1 and 3 which belong to different group IDs. However, it will inherit record 3’s group ID (<code>3</code>) because that was assigned at stage 1 (<code>&quot;CRI 01&quot;</code>) as opposed to record 2’s group ID which was assigned at stage 2 (<code>&quot;CRI 02&quot;</code>).</li>
</ul>
<p><strong>Example 2</strong></p>
<p><strong>Figure 2: Record group expansion</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">forename =</span> <span class="kw">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;John&quot;</span>, <span class="st">&quot;Jon&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;Mary&quot;</span>,<span class="st">&quot;Mary&quot;</span>,<span class="st">&quot;Mariam&quot;</span>, <span class="st">&quot;John&quot;</span>, <span class="st">&quot;Henry&quot;</span>, <span class="st">&quot;Obinna&quot;</span>, <span class="st">&quot;Tomi&quot;</span>),
  <span class="dt">surname =</span> <span class="kw">c</span>(<span class="st">&quot;Swan&quot;</span>, <span class="st">&quot;Swanley&quot;</span>, <span class="st">&quot;Swanley&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;Jane&quot;</span>,<span class="st">&quot;Jan&quot;</span>,<span class="st">&quot;Janet&quot;</span>, <span class="st">&quot;Swan&quot;</span>, <span class="st">&quot;Henderson&quot;</span>, <span class="st">&quot;Nelson&quot;</span>, <span class="st">&quot;Abdulkareem&quot;</span>), 
  <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">12</span>,<span class="dv">11</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">30</span>,<span class="dv">31</span>, <span class="dv">2500</span>)
)

df<span class="op">$</span>pids_a &lt;-<span class="st"> </span><span class="kw">record_group</span>(df, <span class="dt">criteria =</span> <span class="kw">c</span>(forename, surname, age), <span class="dt">to_s4 =</span> T, <span class="dt">display =</span> F)
<span class="co">#&gt; Record grouping complete: 3 record(s) with a unique ID.</span>
 
df
<span class="co">#&gt;    forename     surname  age        pids_a</span>
<span class="co">#&gt; 1      John        Swan   12 P.01 (CRI 01)</span>
<span class="co">#&gt; 2      John     Swanley   11 P.01 (CRI 01)</span>
<span class="co">#&gt; 3       Jon     Swanley   10 P.01 (CRI 02)</span>
<span class="co">#&gt; 4                         10 P.01 (CRI 03)</span>
<span class="co">#&gt; 5      Mary        Jane    5 P.05 (CRI 01)</span>
<span class="co">#&gt; 6      Mary         Jan    6 P.05 (CRI 01)</span>
<span class="co">#&gt; 7    Mariam       Janet    6 P.05 (CRI 03)</span>
<span class="co">#&gt; 8      John        Swan   12 P.01 (CRI 01)</span>
<span class="co">#&gt; 9     Henry   Henderson   30 P.09 (No Hit)</span>
<span class="co">#&gt; 10   Obinna      Nelson   31 P.10 (No Hit)</span>
<span class="co">#&gt; 11     Tomi Abdulkareem 2500 P.11 (No Hit)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<ul>
<li>Stage 1 (criteria) - Records 1, 2 and 8 have matching surnames and so are grouped together. Similarly, records 5 and 6 are grouped together for the same reason. Record 4 is not assigned a group ID at this stage because of missing values. Records 3, 4, 7, 9, 10 and 11 are also not assigned a group ID at this stage because they do not match any other record.</li>
<li>Stage 2 (criteria) - Record 3 has the same surname as record 2 and so inherits record 2’s group ID (<code>1</code>). The other records still do not match any other record at this stage and so remain unassigned.<br />
</li>
<li>Stage 3 (criteria) - Record 4 has the same age as record record 3 and so inherits it’s group ID (<code>1</code>). Similarly, record 7 inherits record 6’s group ID for the same reason.</li>
<li>No hit - Records 9, 10 and 11 did not match any other record on forename, surname or age therefore, they are assigned to unique group IDs.</li>
</ul>
<p><a id="missing_values"></a></p>
</div>
<div id="handling-missing-values" class="section level2">
<h2>Handling missing values</h2>
<p>Records with missing values for a particular <code>criteria</code> are excluded from that stage of record linkage. If a record has missing values for every listed <code>criteria</code>, it’s assigned a unique group ID at the end of the process.</p>
<p>It’s common for databases to use specific characters or numbers to represent missing or unknown data e.g. <code>N/A</code>, <code>Nil</code>, <code>01/01/1100</code>, <code>111111</code> e.t.c. These pseudo-missing values will need to be re-coded to one of the two recognised by <code>record_group()</code> - <code>NA</code> or an empty string (<code>&quot;&quot;</code>). If this is not done, the function will assume the pseudo-missing values are valid values and therefore group them together. This can cause a continuous cascade of false matches as seen below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_list_<span class="dv">2</span><span class="op">$</span>forename &lt;-<span class="st"> </span><span class="kw">ifelse</span>(patient_list_<span class="dv">2</span><span class="op">$</span>rd_id <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="st">&quot;Nil&quot;</span>, patient_list_<span class="dv">2</span><span class="op">$</span>forename)
<span class="co"># 2 stage linkage</span>
    <span class="co"># Stage 1 - forename</span>
    <span class="co"># Stage 2 - surname</span>

patient_list_<span class="dv">2</span><span class="op">$</span>pids_b &lt;-<span class="st"> </span><span class="kw">record_group</span>(patient_list_<span class="dv">2</span>, <span class="dt">criteria =</span> <span class="kw">c</span>(forename, surname), 
                                      <span class="dt">display =</span> F, <span class="dt">to_s4 =</span>T)
<span class="co">#&gt; Record grouping complete: 2 record(s) with a unique ID.</span>

patient_list_<span class="dv">2</span>[<span class="kw">c</span>(<span class="st">&quot;forename&quot;</span>,<span class="st">&quot;surname&quot;</span>,<span class="st">&quot;pids_b&quot;</span>)]
<span class="co">#&gt;   forename     surname       pids_b</span>
<span class="co">#&gt; 1      Nil   Jefferson P.1 (CRI 01)</span>
<span class="co">#&gt; 2      Nil   Jefferson P.1 (CRI 01)</span>
<span class="co">#&gt; 3      Nil       Abdul P.1 (CRI 01)</span>
<span class="co">#&gt; 4     Tomi Abdulkareem P.4 (No Hit)</span>
<span class="co">#&gt; 5     &lt;NA&gt;        &lt;NA&gt; P.5 (No Hit)</span></code></pre></div>
<p><a id="range_matching"></a></p>
<p>In the example above, records 1-3 are assigned a single group ID even though record 3 is clearly a different person. This issue can be addressed by recoding <code>&quot;Nil&quot;</code> to <code>NA</code> or <code>&quot;&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using NA as the proxy for missing value</span>
patient_list_<span class="dv">2</span><span class="op">$</span>forename &lt;-<span class="st"> </span><span class="kw">ifelse</span>(patient_list_<span class="dv">2</span><span class="op">$</span>forename<span class="op">==</span><span class="st">&quot;Nil&quot;</span>, <span class="ot">NA</span>, patient_list_<span class="dv">2</span><span class="op">$</span>forename)

patient_list_<span class="dv">2</span><span class="op">$</span>pids_d &lt;-<span class="st"> </span><span class="kw">record_group</span>(patient_list_<span class="dv">2</span>, rd_id, <span class="kw">c</span>(forename, surname), 
                                      <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 3 record(s) with a unique ID.</span>

<span class="co"># Using &quot;&quot; as the proxy for missing value</span>
patient_list_<span class="dv">2</span><span class="op">$</span>forename &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(patient_list_<span class="dv">2</span><span class="op">$</span>forename),<span class="st">&quot;&quot;</span>,patient_list_<span class="dv">2</span><span class="op">$</span>forename)  

patient_list_<span class="dv">2</span><span class="op">$</span>pids_e &lt;-<span class="st"> </span><span class="kw">record_group</span>(patient_list_<span class="dv">2</span>, rd_id, <span class="kw">c</span>(forename, surname), 
                                      <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 3 record(s) with a unique ID.</span>

patient_list_<span class="dv">2</span>[<span class="kw">c</span>(<span class="st">&quot;forename&quot;</span>,<span class="st">&quot;surname&quot;</span>, <span class="st">&quot;pids_b&quot;</span>, <span class="st">&quot;pids_d&quot;</span>,<span class="st">&quot;pids_e&quot;</span>)]
<span class="co">#&gt;   forename     surname       pids_b       pids_d       pids_e</span>
<span class="co">#&gt; 1            Jefferson P.1 (CRI 01) P.1 (CRI 02) P.1 (CRI 02)</span>
<span class="co">#&gt; 2            Jefferson P.1 (CRI 01) P.1 (CRI 02) P.1 (CRI 02)</span>
<span class="co">#&gt; 3                Abdul P.1 (CRI 01) P.3 (No Hit) P.3 (No Hit)</span>
<span class="co">#&gt; 4     Tomi Abdulkareem P.4 (No Hit) P.4 (No Hit) P.4 (No Hit)</span>
<span class="co">#&gt; 5                 &lt;NA&gt; P.5 (No Hit) P.5 (No Hit) P.5 (No Hit)</span></code></pre></div>
</div>
<div id="approximate-matching---text-transformation-and-range-matching" class="section level2">
<h2>Approximate matching - text transformation and range matching</h2>
<p>Sometimes an exact match might be too strict and a less exact but reasonable approximation can be used. For example in <code>patient_list_2</code> above, records 3 and 4 seem to be the same individual but are not grouped together because the surnames are not an exact match. An alternative approach can be to use the surname initials or a Soundex transformation of the actual surname.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_list_<span class="dv">2</span><span class="op">$</span>soundex &lt;-<span class="st"> </span>stringdist<span class="op">::</span><span class="kw">phonetic</span>(patient_list_<span class="dv">2</span><span class="op">$</span>surname)
patient_list_<span class="dv">2</span><span class="op">$</span>pids_e &lt;-<span class="st"> </span><span class="kw">record_group</span>(patient_list_<span class="dv">2</span>, rd_id, <span class="kw">c</span>(forename, soundex), 
                                      <span class="dt">display =</span> F, <span class="dt">to_s4 =</span> T)
<span class="co">#&gt; Record grouping complete: 1 record(s) with a unique ID.</span>

patient_list_<span class="dv">2</span>[<span class="kw">c</span>(<span class="st">&quot;forename&quot;</span>,<span class="st">&quot;surname&quot;</span>,<span class="st">&quot;soundex&quot;</span>,<span class="st">&quot;pids_d&quot;</span>,<span class="st">&quot;pids_e&quot;</span>)]
<span class="co">#&gt;   forename     surname soundex       pids_d       pids_e</span>
<span class="co">#&gt; 1            Jefferson    J162 P.1 (CRI 02) P.1 (CRI 02)</span>
<span class="co">#&gt; 2            Jefferson    J162 P.1 (CRI 02) P.1 (CRI 02)</span>
<span class="co">#&gt; 3                Abdul    A134 P.3 (No Hit) P.3 (CRI 02)</span>
<span class="co">#&gt; 4     Tomi Abdulkareem    A134 P.4 (No Hit) P.3 (CRI 02)</span>
<span class="co">#&gt; 5                 &lt;NA&gt;    &lt;NA&gt; P.5 (No Hit) P.5 (No Hit)</span></code></pre></div>
<p>For continuous data, you can use the function’s range matching feature. In range matching, numeric values are “matched” if they are within a specified range of other values. To do this, convert each value to the required range using <code>number_line()</code>. Then assign the actual value to the <code>gid</code> slot of the resulting <code>number_line</code> object. The <code>number_line</code> object can then be used as a <code>criteria</code> or <code>sub_criteria</code>. <code>number_line</code> objects are considered a match if they overlap. See the examples below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Opes_c &lt;-<span class="st"> </span>Opes[<span class="st">&quot;date_of_birth&quot;</span>]
Opes_c<span class="op">$</span>date_of_birth
<span class="co">#&gt; [1] &quot;23/03/1986&quot; &quot;23/03/1986&quot; &quot;23/03/1968&quot; &quot;01/02/1985&quot; &quot;02/01/1985&quot;</span>
<span class="co">#&gt; [6] &quot;11/03/1964&quot; &quot;11/03/1964&quot; &quot;11/10/1985&quot;</span>

<span class="co"># Match on date of birth + 2 years</span>
Opes_c<span class="op">$</span>date_of_birth &lt;-<span class="st"> </span><span class="kw">as.Date</span>(Opes_c<span class="op">$</span>date_of_birth, <span class="st">&quot;%d/%m/%Y&quot;</span>)
Opes_c<span class="op">$</span>range_a &lt;-<span class="st"> </span><span class="kw">expand_number_line</span>(<span class="kw">as.number_line</span>(Opes_c<span class="op">$</span>date_of_birth), (<span class="dv">365</span><span class="op">*</span><span class="dv">2</span>), <span class="st">&quot;end&quot;</span>)
Opes_c<span class="op">$</span>range_a<span class="op">@</span>gid &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(Opes_c<span class="op">$</span>date_of_birth)

Opes_c<span class="op">$</span>pids_a &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes_c, <span class="dt">criteria =</span> range_a, <span class="dt">to_s4 =</span>T)
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `dmvr_d1`</span>
<span class="co">#&gt; Matching criteria 1: iteration 2</span>
<span class="co">#&gt; Matching criteria 1: iteration 3</span>
<span class="co">#&gt; Matching criteria 1: iteration 4</span>
<span class="co">#&gt; Matching criteria 1: iteration 5</span>
<span class="co">#&gt; Matching criteria 1: iteration 6</span>
<span class="co">#&gt; Matching criteria 1: iteration 7</span>
<span class="co">#&gt; Matching criteria 1: iteration 8</span>
<span class="co">#&gt; 8 records(s): 7 assigned to record groups and 1 left to group.</span>
<span class="co">#&gt; Record grouping complete: 1 record(s) with a unique ID.</span>

Opes_c[<span class="kw">c</span>(<span class="st">&quot;date_of_birth&quot;</span>,<span class="st">&quot;range_a&quot;</span>,<span class="st">&quot;pids_a&quot;</span>)]
<span class="co">#&gt;   date_of_birth                  range_a       pids_a</span>
<span class="co">#&gt; 1    1986-03-23 1986-03-23 -&gt; 1988-03-22 P.5 (CRI 01)</span>
<span class="co">#&gt; 2    1986-03-23 1986-03-23 -&gt; 1988-03-22 P.5 (CRI 01)</span>
<span class="co">#&gt; 3    1968-03-23 1968-03-23 -&gt; 1970-03-23 P.3 (No Hit)</span>
<span class="co">#&gt; 4    1985-02-01 1985-02-01 -&gt; 1987-02-01 P.5 (CRI 01)</span>
<span class="co">#&gt; 5    1985-01-02 1985-01-02 -&gt; 1987-01-02 P.5 (CRI 01)</span>
<span class="co">#&gt; 6    1964-03-11 1964-03-11 -&gt; 1966-03-11 P.6 (CRI 01)</span>
<span class="co">#&gt; 7    1964-03-11 1964-03-11 -&gt; 1966-03-11 P.6 (CRI 01)</span>
<span class="co">#&gt; 8    1985-10-11 1985-10-11 -&gt; 1987-10-11 P.5 (CRI 01)</span>

<span class="co"># Match on age +/- 5 years</span>
Opes_c<span class="op">$</span>age &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">round</span>((<span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span>Opes_c<span class="op">$</span>date_of_birth)<span class="op">/</span><span class="fl">365.5</span>)) <span class="co"># approximate age</span>
Opes_c<span class="op">$</span>range_b &lt;-<span class="st"> </span><span class="kw">expand_number_line</span>(<span class="kw">as.number_line</span>(Opes_c<span class="op">$</span>age), <span class="dv">5</span>, <span class="st">&quot;both&quot;</span>)
Opes_c<span class="op">$</span>range_b<span class="op">@</span>gid &lt;-<span class="st"> </span>Opes_c<span class="op">$</span>age

Opes_c<span class="op">$</span>pids_b &lt;-<span class="st"> </span><span class="kw">record_group</span>(Opes_c, <span class="dt">criteria =</span> range_b, <span class="dt">to_s4 =</span>T)
<span class="co">#&gt; </span>
<span class="co">#&gt; Group criteria 1 - `dmvr_d1`</span>
<span class="co">#&gt; Matching criteria 1: iteration 2</span>
<span class="co">#&gt; 8 records(s): 8 assigned to record groups and 0 left to group.</span>
<span class="co">#&gt; Record grouping complete: 0 record(s) with a unique ID.</span>

Opes_c[<span class="kw">c</span>(<span class="st">&quot;age&quot;</span>,<span class="st">&quot;range_b&quot;</span>,<span class="st">&quot;pids_b&quot;</span>)]
<span class="co">#&gt;   age  range_b       pids_b</span>
<span class="co">#&gt; 1  34 29 -&gt; 39 P.1 (CRI 01)</span>
<span class="co">#&gt; 2  34 29 -&gt; 39 P.1 (CRI 01)</span>
<span class="co">#&gt; 3  52 47 -&gt; 57 P.3 (CRI 01)</span>
<span class="co">#&gt; 4  35 30 -&gt; 40 P.1 (CRI 01)</span>
<span class="co">#&gt; 5  35 30 -&gt; 40 P.1 (CRI 01)</span>
<span class="co">#&gt; 6  56 51 -&gt; 61 P.3 (CRI 01)</span>
<span class="co">#&gt; 7  56 51 -&gt; 61 P.3 (CRI 01)</span>
<span class="co">#&gt; 8  35 30 -&gt; 40 P.1 (CRI 01)</span></code></pre></div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>As a general rule, the more unique a criteria, the earlier it should be listed in <code>criteria</code>. Also, the set and ordering of <code>criteria</code> is a personal choice but should also be a practical one for any given dataset. For example, when linking a vehicular database with no existing identifier, vehicle colour alone is less practical than colour and brand name, which in turn is less practical than colour, brand name, make and model. However colour, brand name, make and model and 10 other parameters might be too strict and may need to be relaxed. On the other hand, the dataset could be so small that vehicle colour alone is a sufficient <code>criteria</code>. <code>record_group()</code> aims to minimize false mismatches due to random data entry errors or missing values. The choice and ordering of <code>criteria</code> and <code>sub_criteria</code> should balance the availability of alternative identifiers with their practicality as a group identifier.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
